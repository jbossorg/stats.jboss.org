<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>JBoss.org Statistics</title>
    <link rel="icon" type="image/x-icon" href="http://static.jboss.org/ffe/images/favicon.ico" />
    <link type="text/css" href="http://static.jboss.org/ffe/theme/css/bootstrap-community/3.2.0.0/bootstrap-community.min.css" media="all" rel="stylesheet" />
    <link type="text/css" href="./bootstrap-datepicker-1.3.0/css/datepicker3.css" media="all" rel="stylesheet" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="./jquery-dateFormat.min.js"></script>
    <script type="text/javascript" src="./bootstrap-datepicker-1.3.0/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="http://static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.0/bootstrap-community.min.js"></script>
    <script type="text/javascript">

      function switchAvailablePresentationOptions(turnOnMultibucket) {

        var elements = document.getElementsByName("presentation");

        if (turnOnMultibucket) {

          elements[0].disabled = true;
          elements[1].disabled = true;
          elements[2].disabled = true;
          elements[3].disabled = false;
          elements[4].disabled = false;

          if (!elements[3].checked && !elements[4].checked ) {
            elements[3].checked=true;
          }

        } else {

          elements[0].disabled = false;
          elements[1].disabled = false;
          elements[2].disabled = false;
          elements[3].disabled = true;
          elements[4].disabled = true;

          if (!elements[0].checked && !elements[1].checked && !elements[2].checked) {
            elements[0].checked=true;
          }

        }

      }

      google.load("visualization", "1", {packages:["corechart"]});

      function drawChart(blogsData, divId, title, interval, chartType) {

        var dateFormat = "MM.yyyy";
        switch(interval) {
          case 'year':
            dateFormat = "yyyy";
            break;
          case 'day':
            dateFormat = "dd.MM.yyyy";
            break;
        };

        if(chartType=='lineChart') {

          var options = {
            title: title,
            legend: { position: 'none' },
          };

          var chart = new google.visualization.LineChart(document.getElementById(divId));
          chart.draw(transformDataForRenderingChart(blogsData,dateFormat,false), options);

        } else if (chartType=='barsChart') {

          var options = {
            title: title,
            legend: { position: 'none' },
          };

          var chart = new google.visualization.BarChart(document.getElementById(divId));
          chart.draw(transformDataForRenderingChart(blogsData,dateFormat,false), options);

        } else if (chartType=='donutChart') {

          var options = {
            title: title,
            legend: { position: 'none' },
            pieHole: 0.4
          };

          var chart = new google.visualization.PieChart(document.getElementById(divId));
          chart.draw(transformDataForRenderingChart(blogsData,dateFormat,false), options);

        } else if (chartType=='multilineChart') {

          var options = {
            title: title,
            legend: { position: 'none' },
          };

          var chart = new google.visualization.LineChart(document.getElementById(divId));
          chart.draw(transformDataForRenderingChart(blogsData,dateFormat,true), options);

        } else if (chartType=='stackedBarsChart') {

          var options = {
            title: title,
            legend: { position: 'none' },
            isStacked: true
          };

          var chart = new google.visualization.BarChart(document.getElementById(divId));
          chart.draw(transformDataForRenderingChart(blogsData,dateFormat,true), options);

        } else if (chartType=='donutCharts') {

          var options = {
            title: title,
            legend: { position: 'none' },
            pieHole: 0.4
          };

          var chart = new google.visualization.PieChart(document.getElementById(divId));
          chart.draw(transformDataForRenderingChart(blogsData,dateFormat,true), options);

        }

      }

      function transformDataForRenderingChart(data, dateFormat, nestedBuckets) {

        var transformedData = [];

        if (nestedBuckets) {

          // Collecting all names from buckets
          var namesObj={};
          for (i = 0, l=data.length; i < l; i++) { 
            var bucketsWithNames;
            if (data[i].secondLevel.thirdLevel === undefined) {
              bucketsWithNames= data[i].secondLevel.buckets;
            } else {
              bucketsWithNames= data[i].secondLevel.thirdLevel.buckets;
            }

            for (j=0, k=bucketsWithNames.length ; j<k; j++) {
              namesObj[bucketsWithNames[j].key]=1;
            }
          }

          var namesArray = Object.keys(namesObj);
          namesArray.unshift('Time');
          transformedData[transformedData.length] = namesArray;

          // Transforming the results into chartable data structure
          for (i = 0, l=data.length; i < l; i++) {

            var lastLevelBuckets;
            if (data[i].secondLevel.thirdLevel === undefined) {
              lastLevelBuckets= data[i].secondLevel.buckets;
            } else {
              lastLevelBuckets= data[i].secondLevel.thirdLevel.buckets;
            }
            var rowOfData = Array.apply(null, new Array(namesArray.length-1)).map(Number.prototype.valueOf,0);

            var formattedDate = $.format.date(new Date(data[i].key),dateFormat);
            rowOfData.unshift(formattedDate);

            for (j=0, k=lastLevelBuckets.length ; j<k; j++) {
              rowOfData[namesArray.indexOf(lastLevelBuckets[j].key)]=lastLevelBuckets[j].doc_count;
            }
            transformedData[transformedData.length]=rowOfData;
          }

        } else {

          transformedData[transformedData.length]=['Time','Count'];
          for (i = 0; i < data.length; i++) { 
            var formattedDate = $.format.date(new Date(data[i].key),dateFormat);
            transformedData[transformedData.length] = [formattedDate,data[i].doc_count];
          }
        }
        
        
        console.log(transformedData);
        return google.visualization.arrayToDataTable(transformedData);
      }

    </script>

    <link href="./select2-3.5.2/select2.css" rel="stylesheet"/>
    <script src="./select2-3.5.2/select2.js"></script>

  </head>
  <body>
    <div class="container" id="content">
      <div class="dropup"><div id="ajbossproject">A JBoss Project</div> <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
        <script>
          window.addEventListener('load', function() { renderTabzilla("stats.jboss.org","statistics" , false ) }, true);
        </script>
      </div>
      <div class="banner">
        <div class="row">
          <div class="form-horizontal">
            <div class="form-group">
              <div class="col-md-1"> </div>
              <div class="col-md-8">
                <h1>JBoss.org Statistics are awesome!</h1>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-horizontal">
          <div class="form-group">
            <div class="col-md-1" > </div>
            <div class="col-md-2">
              <label class="control-label" for="serverUrl">Searchisko API URL:</label>
            </div>
            <div class="col-md-6">
              <input class="form-control" type="text" id="serverUrl" autocomplete="on"
                onChange="$(this).parent().parent().removeClass('has-error');" />
            </div>
            <div class="col-md-3" id="login-info">
              <a href="https://sso-dev.jboss.org/login">Log In</a> | <a href="https://developer-dev.jboss.org/register.jspa">Register</a>
            </div>
          </div>
        </div>
      </div>
      <form id="settings" >
      <fieldset>
      <div class="panel-group" id="accordion2">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title"><a class="accordion-toggle" data-parent="#accordion2" data-toggle="collapse" href="#collapseOne">Filters</a></h4>
          </div>
          <div class="panel-collapse collapse in" id="collapseOne">
            <div class="panel-body">
              <div class="form-horizontal">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label class="col-md-4 control-label" for="toDate">Aggregate: </label>
                      <div class="controls col-md-8">
                        <div class="radio" >
                          <label>
                            <input type="radio" name="interval" value="day" />Daily
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="interval" value="month" checked />Monthly
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="interval" value="year" />Yearly
                          </label>
                        </div>
                      </div>
                    </div>
                    <br />
                    <div class="form-group"> 
                      <label class="col-md-4 control-label" for="fromDate">Date from: </label>
                      <div class="controls col-md-4">
                        <input class="form-control" type="text" id="fromDate" />
                      </div>
                      <div class="controls col-md-4">
                        <a class="btn btn-danger" onClick="$('#fromDate')[0].value='';">
                          <i class="icon-trash icon-lg"></i> Clear </a>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-md-4 control-label" for="toDate">Date to: </label>
                      <div class="controls col-md-4">
                        <input type="text" class="form-control" id="toDate">
                      </div>
                      <div class="controls col-md-4">
                        <a class="btn btn-danger" onClick="$('#toDate')[0].value='';">
                          <i class="icon-trash icon-lg"></i> Clear </a>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-8">
                    <div class="row">
                      <div class="form-group col-md-6">
                        <label class="col-md-4 control-label" for="product">Projects or Products: </label>
                        <div class="controls col-md-8">
                          <div class="radio" >
                            <label>
                              <input type="radio" name="product" value="all" checked />All
                            </label>
                          </div>
                          <div class="radio" >
                            <label>
                              <input type="radio" name="product" value="false"  />Only projects
                            </label>
                          </div>
                          <div class="radio" >
                            <label>
                              <input type="radio" name="product" value="true" />Only products
                            </label>
                          </div>
                        </div>
                      </div>
                      <div class="form-group col-md-6" id="createdByDiv" >
                        <label class="col-md-4 control-label" for="employee">Created by: </label>
                        <div class="controls col-md-8">
                          <div class="radio" >
                            <label>
                              <input type="radio" name="employee" value="anyone" checked />Anyone
                            </label>
                          </div>
                          <div class="radio" >
                            <label>
                              <input type="radio" name="employee" value="true"  />Red Hat employee
                            </label>
                          </div>
                          <div class="radio" >
                            <label>
                              <input type="radio" name="employee" value="false" />Non-redhatter
                            </label>
                          </div>
                        </div>
                      </div>
                    </div>
                    <br />
                    <!-- <div class="row">
                      <div class="form-group">
                        <label class="col-md-4 control-label" for="employee">Projects/products filter: </label>
                        <div class="controls col-md-6">
                          <input type="hidden" id="projectsSelect" />
                        </div>
                        <div class="controls col-md-1">
                          <a class="btn btn-danger" onClick="$('#projectsSelect').select2('val', '');">
                           <i class="icon-trash icon-lg"></i> Clear </a>
                         </div>
                      </div>
                      <div class="form-group">
                        <label class="col-md-4 control-label" for="employee">Authors filter: </label>
                        <div class="controls col-md-6">
                          <input type="hidden" id="authorsSelect" />
                        </div>
                        <div class="controls col-md-1">
                          <a class="btn btn-danger" onClick="$('#authorsSelect').select2('val', '');">
                           <i class="icon-trash icon-lg"></i> Clear </a>
                        </div>
                      </div>
                    </div> -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title"><a class="accordion-toggle" data-parent="#accordion2" data-toggle="collapse" href="#collapseTwo">Presentation options</a></h4>
          </div>
          <div class="panel-collapse collapse in" id="collapseTwo">
            <div class="panel-body">
              <div class="form-horizontal">
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label class="col-md-4 control-label" for="employee">Split results by: </label>
                      <div class="controls col-md-8">
                        <div class="radio" >
                          <label>
                            <input type="radio" name="bucket" value="off" checked onClick="switchAvailablePresentationOptions(false);" />Nothing
                          </label>
                        </div>
                        <div class="radio" id="employeeStatusDiv">
                          <label>
                            <input type="radio" name="bucket" value="employeeStatus" onClick="switchAvailablePresentationOptions(true);" />Red Hat employees vs. non-redhatters
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="bucket" value="productStatus" onClick="switchAvailablePresentationOptions(true);" />Projects vs. products
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="bucket" value="perAuthor" onClick="switchAvailablePresentationOptions(true);" />Per each author
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="bucket" value="perProject" onClick="switchAvailablePresentationOptions(true);" />Per each project/product
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label class="col-md-4 control-label" for="employee">Results presentation: </label>
                      <div class="controls col-md-8">
                        <div class="radio" >
                          <label>
                            <input type="radio" name="presentation" value="lineChart" checked />Line chart
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="presentation" value="barsChart"/>Bars chart
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="presentation" value="donutChart" />Donut chart
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="presentation" value="multilineChart" disabled />Multiline chart
                          </label>
                        </div>
                        <div class="radio" >
                          <label>
                            <input type="radio" name="presentation" value="stackedBarsChart" disabled />Stacked bars chart
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title"><a class="accordion-toggle collapsed" data-parent="#accordion2" data-toggle="collapse" href="#collapseThree">Presets</a></h4>
          </div>
          <div class="panel-collapse collapse" id="collapseThree">
            <div class="panel-body">
              <div class="form-horizontal">
                <div class="row">
                  <div class="col-md-1"><div class="form-group"></div></div>
                  <div class="col-md-1">
                    <div class="form-group">
                      <a class="btn btn-success" href="#" id="Preset1">Preset no.1</a>
                    </div>
                  </div>
                  <div class="col-md-1"><div class="form-group"></div></div>
                  <div class="col-md-1">
                    <div class="form-group">
                      <a class="btn btn-success" href="#" id="Preset1">Preset no.2</a>
                    </div>
                  </div>
                  <div class="col-md-1"><div class="form-group"></div></div>
                  <div class="col-md-1">
                    <a class="btn btn-success" href="#" id="Preset1">Preset no.3</a>
                  </div>
                  <div class="col-md-1"><div class="form-group"></div></div>
                  <div class="col-md-1">
                    <a class="btn btn-success" href="#" id="Preset1">Preset no.4</a>
                  </div>
                  <div class="col-md-1"><div class="form-group"></div></div>
                  <div class="col-md-1">
                    <a class="btn btn-success" href="#" id="Preset1">Preset no.5</a>
                  </div>
                  <div class="col-md-1"><div class="form-group"></div></div>
                  <div class="col-md-1"><div class="form-group"></div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        -->
      </div>
      <div class="row">
        <div class="col-md-2 col-md-offset-5">
          <a class="btn btn-primary btn-lg" onClick="if(checkIfServerUrlIsProvided()) drawGraphs();" >Generate graph</a>
        </div>
      </div>
      </fieldset>
      </form>
      <div id="blogsDiv" style="width: 100%; height: 600px;"></div>
      <hr />
      <div id="forumsDiv" style="width: 100%; height: 600px;"></div>
      <hr />
      <div id="articlesDiv" style="width: 100%; height: 600px;"></div>
      <hr />
      <div id="jiraDiv" style="width: 100%; height: 600px;"></div>
      <hr />
      <div id="mailingListDiv" style="width: 100%; height: 600px;"></div>

      <script type="text/javascript">

      var statsConfig = {};

      function initializeRoleBasedSettings() {

        if (statsConfig.userRoles && statsConfig.userRoles.indexOf("admin")!=-1 ) {
          $( "#employeeStatusDiv" ).show();
          $( "#createdByDiv" ).show();
          statsConfig.query="statsJBossOrgQueryWithAdminRole";
        } else {
          $( "#employeeStatusDiv" ).hide();
          $( "#createdByDiv" ).hide();
          statsConfig.query="statsJBossOrgQuery";
        }

      }

      function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
          var pair = vars[i].split("=");
          if(pair[0] == variable){return pair[1];}
        }
        return(false);
      }

        function checkIfServerUrlIsProvided() {
          var serverUrlField = $( "#serverUrl" );
          if (!serverUrlField.val()) {
            serverUrlField.parent().parent().addClass('has-error');
            window.scrollTo(0,0);
            serverUrlField.focus();
            return false;
          }
          return true;
        }

        function getSelectedOptions(oList)
        {
          var sdValues = [];
          for(var i = 1; i < oList.options.length; i++) {
            if(oList.options[i].selected == true) {
              sdValues.push(oList.options[i].value);
            }
          }
          return sdValues;
        }

        var datepickerOptions = { autoclose: true, format: "yyyy-mm-dd" };
        $( "#fromDate" ).datepicker(datepickerOptions);
        $( "#toDate" ).datepicker(datepickerOptions);

        function drawGraphs() {

          var urlParameters = "";

          var serverUrl = $( "#serverUrl" ).val();

          var fromDateField = $( "#fromDate" );
          var toDateField = $( "#toDate" );
          var productRadioVal = $('input[name=product]:checked', '#settings').val();
          var employeeRadioVal = $('input[name=employee]:checked', '#settings').val();
          var presentationRadioVal = $('input[name=presentation]:checked', '#settings').val();
          var bucketRadioVal = $('input[name=bucket]:checked', '#settings').val();
          var projectSelectedArr = $("#projectsSelect").select2("data");
          var authorsSelectedArr = $("#authorsSelect").select2("data");
          var interval = $('input[name=interval]:checked', '#settings').val();

          if (bucketRadioVal!='off') {

            urlParameters+="&second_level_aggregation=true";

            switch (bucketRadioVal) {

              case "employeeStatus" : 
                urlParameters+="&employee_nonemployee_aggregation=true"; break;
              case "productStatus" : 
                urlParameters+="&product_project_aggregation=true"; break;
              case "perAuthor" : 
                urlParameters+="&sys_contributor_aggregation=true"; break;
              case "perProject" : 
                urlParameters+="&sys_project_aggregation=true"; break;
            }

          }

          if (fromDateField.val() || toDateField.val() || productRadioVal!='all' || employeeRadioVal != 'anyone'
            || projectSelectedArr.length>0 || authorsSelectedArr.length>0 ) {

            if (fromDateField.val() || toDateField.val()) {

              urlParameters+="&date_range_check=true";

              if (fromDateField.val()) {
                urlParameters+="&from_date="+fromDateField.val()+"T00:00:00.000Z";
              }
              if (toDateField.val()) {
                urlParameters+="&to_date="+toDateField.val()+"T00:00:00.000Z";
              }

            }

            
            if (productRadioVal !== undefined && productRadioVal!='all') {
              urlParameters+="&is_product_check=true&is_product="+productRadioVal;
            }

            if (employeeRadioVal !== undefined && employeeRadioVal!='anyone') {
              urlParameters+="&is_employee_check=true&is_employee="+employeeRadioVal;
            }

            if (projectSelectedArr.length>0 ) {

              urlParameters += "&project_names_filter";

              for (var idx=0 ; idx < projectSelectedArr.length ; idx++ ) {
                urlParameters += "&sys_projects="+projectSelectedArr[idx].id;
              }

            }
            
            if (authorsSelectedArr.length>0 ) {

              urlParameters += "&sys_contributors_filter";

              var idsArr = [];
              for (var idx=0 ; idx < authorsSelectedArr.length ; idx++ ) {
                urlParameters += "&sys_contributors="+authorsSelectedArr[idx].id;
              }

            }

          }
          
          urlParameters+="&interval="+interval;

          console.log("URL PARAMETERS: "+urlParameters);

          $.ajax({
            type: "GET",
            url: statsConfig.serverUrl+'/v2/rest/search/'+statsConfig.query+'?sys_type=blogpost'+urlParameters,
            xhrFields : {withCredentials:true},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(results) {
              console.log(results);
              if (results.aggregations.firstLevel.buckets.length) {
                drawChart(results.aggregations.firstLevel.buckets,'blogsDiv','Number of blog posts.',
                  interval, presentationRadioVal);
              } else {
                var blogsDivRef = $('#blogsDiv');
                blogsDivRef.empty();
                blogsDivRef.html('<h3>No results for blogs posts report.</h3>');
              }
        
            }
          });

          $.ajax({
            type: "GET",
            url: statsConfig.serverUrl+'/v2/rest/search/'+statsConfig.query+'?sys_type=forumthread'+urlParameters,
            xhrFields : {withCredentials:true},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(results) {
              console.log(results);
              if (results.aggregations.firstLevel.buckets.length) {
                drawChart(results.aggregations.firstLevel.buckets,'forumsDiv','Number of forum threads.',
                  interval, presentationRadioVal);
              } else {
                var blogsDivRef = $('#forumsDiv');
                blogsDivRef.empty();
                blogsDivRef.html('<h3>No results for forum threads report.</h3>');
              }
        
            }
          });

          $.ajax({
            type: "GET",
            url: statsConfig.serverUrl+'/v2/rest/search/'+statsConfig.query+'?sys_type=article'+urlParameters,
            xhrFields : {withCredentials:true},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(results) {
              console.log(results);
              if (results.aggregations.firstLevel.buckets.length) {
                drawChart(results.aggregations.firstLevel.buckets,'articlesDiv','Number of articles.',
                  interval, presentationRadioVal);
              } else {
                var blogsDivRef = $('#articlesDiv');
                blogsDivRef.empty();
                blogsDivRef.html('<h3>No results for articles report.</h3>');
              }
        
            }
          });

          $.ajax({
            type: "GET",
            url: statsConfig.serverUrl+'/v2/rest/search/'+statsConfig.query+'?sys_type=issue'+urlParameters,
            xhrFields : {withCredentials:true},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(results) {
              console.log(results);
              if (results.aggregations.firstLevel.buckets.length) {
                drawChart(results.aggregations.firstLevel.buckets,'jiraDiv','Number of jira issues.',
                  interval, presentationRadioVal);
              } else {
                var blogsDivRef = $('#jiraDiv');
                blogsDivRef.empty();
                blogsDivRef.html('<h3>No results for JIRA report.</h3>');
              }
        
            }
          });

          $.ajax({
            type: "GET",
            url: statsConfig.serverUrl+'/v2/rest/search/'+statsConfig.query+'?sys_type=mailing_list_message'+urlParameters,
            xhrFields : {withCredentials:true},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(results) {
              console.log(results);
              if (results.aggregations.firstLevel.buckets.length) {
                drawChart(results.aggregations.firstLevel.buckets,'mailingListDiv','Number of mails.',
                  interval, presentationRadioVal);
              } else {
                var blogsDivRef = $('#mailListDiv');
                blogsDivRef.empty();
                blogsDivRef.html('<h3>No results for mailing list report.</h3>');
              }
        
            }
          });

          // $.ajax({
          //   type: "GET",
          //   url: serverUrl+'/data_contributor_profile/_search?source='+encodeURIComponent(JSON.stringify(data)),
          //   contentType: "application/json; charset=utf-8",
          //   dataType: "json",
          //   success: function(results) {
          //     console.log(results);
          //     if (results.facets.firstLevel.entries.length) {
          //       drawChart(results.facets.firstLevel.entries,'usersDiv','Number of new users.',data.facets.firstLevel.date_histogram.interval);
          //     } else {
          //       var blogsDivRef = $('#usersDiv');
          //       blogsDivRef.empty();
          //       blogsDivRef.html('<h3>No results for new users report.</h3>');
          //     }
          //   }
          // });

        }


        $("#projectsSelect").select2({ 
          "placeholder" : "None selected" ,
          "width" : "100%",
          "multiple" : true,
          "minimumInputLength" : "2",
          query: function (query) {
            var data = {results: []};
            var serverUrl = $( "#serverUrl" ).val();

            if (!checkIfServerUrlIsProvided()) {
              return data;
            }

              // Getting sys_projects
              $.ajax({
                type: "POST",
                url: serverUrl+'/v2/rest/sys/es/search/sys_projects/_search?size=5&_source_include=code,name',
                data: JSON.stringify({
                  "query" : {
                    "filtered" : {
                      "filter" : {
                        "regexp" : { "code" : ".*"+query.term.toLowerCase()+".*" }
                      }
                    }
                  }
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(results) {
                  console.log(results);

                  var selectObj = $('#projectsSelect', '#settings')[0];

                  if (results.hits.total>0) {

                    results.hits.hits.sort(function(a,b) { 
                      return a._source.name.localeCompare(b._source.name);
                    });

                    for (var index = 0 ; index < results.hits.hits.length ; index++ ) {
                      var name = results.hits.hits[index]._source.name;
                      var code = results.hits.hits[index]._source.code;
                      name = ( name === undefined || name=='' ? code : name ) ;
                      data.results.push({id:code,text: name});
                    }

                  }

                  query.callback(data);
                }
              });
          }
        });

        $("#authorsSelect").select2({ 
          "placeholder" : "None selected" ,
          "width" : "100%",
          "multiple" : true,
          "minimumInputLength" : "2",
          query: function (query) {
            var data = {results: []};
            var serverUrl = $( "#serverUrl" ).val();

            if (!checkIfServerUrlIsProvided()) {
              return data;
            }

            $.ajax({
              type: "POST",
              url: serverUrl+'/v2/rest/sys/es/search/sys_contributors/_search?size=5&_source_include=code',
              data: JSON.stringify(
                {
                  "query" : { 
                    "filtered" : {
                      "filter" : {
                        "regexp" : { "code" : ".*"+query.term.toLowerCase()+".*" }
                      }
                    }
                  }
                }),
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              success: function(results) {

                if (results.hits.total>0) {

                  for (var index = 0 ; index < results.hits.hits.length ; index++ ) {
                    var code = results.hits.hits[index]._source.code;
                    data.results.push({id:code,text: code});
                  }

                }

                query.callback(data);
              }
            });

          }
        });

        $( document ).ready(function() {
          var sv = getQueryVariable('serverUrl');
          if (sv) {
            $( "#serverUrl" ).val(sv);
            statsConfig.serverUrl=sv;
          }

          var loginDiv = $( "#login-info" );
          $.ajax({
            type: "GET",
            url: statsConfig.serverUrl+'/v2/rest/auth/status?roles=a',
            xhrFields:  { withCredentials: true },
            success: function(results) {
              console.log(results);
              if (results.authenticated) {

                $.ajax({
                  type: "GET",
                  url: 'https://sso-dev.jboss.org/logininfo',
                  xhrFields:  { withCredentials: true },
                  success: function(ssoResults) {
                    loginDiv.html(ssoResults.part1+" | "+ssoResults.part2);
                  }
                });

                statsConfig.userRoles=results.roles;
                
              }

              initializeRoleBasedSettings();
            }
          });

        });
        
      </script>

      <div class="container" id="companyfooter">
        <div class="redhatlogo">
          <div id="logospacer"></div>
          <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a>
        </div>
      </div>
      <span class="backToTop" style="display: block;"> <a href="#top">back to top</a> </span>
    </div>
  <body>
</html>
